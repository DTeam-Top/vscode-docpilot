<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <link rel="stylesheet" href="{{cssUri}}">
    <script type="module">
        // Import PDF.js as ES module
        import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.3.93/pdf.min.mjs';
        
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.3.93/pdf.worker.min.mjs';
        
        // Make pdfjsLib available globally
        window.pdfjsLib = pdfjsLib;
    </script>
</head>
<body class="{{theme}}">
    <div class="toolbar">
        <div class="file-info">
            <span>üìÑ {{fileName}}</span>
            <span class="page-info" id="pageInfo">Loading...</span>
        </div>
        <div class="controls">
            <div class="navigation-controls">
                <button class="icon-button" title="First Page" id="firstPageBtn">
                    <img src="{{assetUri}}/first.svg" alt="First Page" width="16" height="16">
                </button>
                <button class="icon-button" title="Previous Page" id="prevPageBtn">
                    <img src="{{assetUri}}/previous.svg" alt="Previous Page" width="16" height="16">
                </button>
                <button class="icon-button" title="Next Page" id="nextPageBtn">
                    <img src="{{assetUri}}/next.svg" alt="Next Page" width="16" height="16">
                </button>
                <button class="icon-button" title="Last Page" id="lastPageBtn">
                    <img src="{{assetUri}}/last.svg" alt="Last Page" width="16" height="16">
                </button>
            </div>
            <button class="icon-button" title="Fit Width" id="fitWidthBtn">
                <img src="{{assetUri}}/fit-width.svg" alt="Fit Width" width="16" height="16">
            </button>
            <button class="icon-button" title="Fit Page" id="fitPageBtn">
                <img src="{{assetUri}}/fit-page.svg" alt="Fit Page" width="16" height="16">
            </button>
            <div class="dropdown" id="aiDropdown">
                <button class="dropdown-btn icon-button" title="AI Tools">
                    <img src="{{assetUri}}/ai.svg" alt="AI Tools" width="16" height="16">
                    ‚ñº
                </button>
                <div class="dropdown-content">
                    <button id="summarizeBtn" class="dropdown-item" title="Summarize this PDF using AI">
                        <img src="{{assetUri}}/summarize.svg" alt="Summarize PDF" width="16" height="16">
                        Summarize
                    </button>
                    <button id="mindmapBtn" class="dropdown-item" title="Generate Mermaid mindmap from this PDF">
                        <img src="{{assetUri}}/mindmap.svg" alt="Generate Mindmap" width="16" height="16">
                        Mindmap
                    </button>
                </div>
            </div>
            <div class="dropdown" id="toolsDropdown">
                <button class="dropdown-btn icon-button" title="Content Tools">
                    <img src="{{assetUri}}/tools.svg" alt="Content Tools" width="16" height="16">
                    ‚ñº
                </button>
                <div class="dropdown-content">
                    <button id="exportBtn" class="dropdown-item" title="Extract Objects">
                        <img src="{{assetUri}}/export.svg" alt="Extract Objects" width="16" height="16">
                        Extract Objects
                    </button>
                    <button id="textSelectionBtn" class="dropdown-item" title="Selection Mode">
                        <img src="{{assetUri}}/view.svg" alt="Selection Mode" width="16" height="16">
                        Selection Mode
                    </button>
                    <button id="searchBtn" class="dropdown-item" title="Search Text">
                        <img src="{{assetUri}}/text-search.svg" alt="Search Text" width="16" height="16">
                        Search Text
                    </button>
                    <button id="screenshotBtn" class="dropdown-item" title="Take Screenshot">
                        <img src="{{assetUri}}/camera.svg" alt="Take Screenshot" width="16" height="16">
                        Screenshot
                    </button>
                    <button id="inspectorBtn" class="dropdown-item" title="PDF Inspector">
                        <img src="{{assetUri}}/wand.svg" alt="PDF Inspector" width="16" height="16">
                        PDF Inspector
                    </button>
                </div>
            </div>
            <button id="debugBtn" class="icon-button" title="Debug Mode">
                <img id="debugIcon" src="{{assetUri}}/bug-off.svg" alt="Debug Mode" width="16" height="16">
            </button>
            <div class="zoom-controls">
                <button class="icon-button" title="Zoom Out" id="zoomOutBtn">
                    <img src="{{assetUri}}/zoom-out.svg" alt="Zoom Out" width="16" height="16">
                </button>
                <input type="range" id="zoomSlider" min="0.25" max="3" step="0.25" value="1" title="Zoom">
                <button class="icon-button" title="Zoom In" id="zoomInBtn">
                    <img src="{{assetUri}}/zoom-in.svg" alt="Zoom In" width="16" height="16">
                </button>
                <span id="zoomLevel">100%</span>
            </div>
        </div>
    </div>
    <div class="warning-banner" id="warningBanner">
        ‚ö†Ô∏è Large document detected. Text selection may impact performance.
    </div>
    <div class="search-overlay" id="searchOverlay" style="display: none;">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search text..." autocomplete="off">
            <button id="searchPrevBtn" title="Previous match">‚Üë</button>
            <button id="searchNextBtn" title="Next match">‚Üì</button>
            <button id="searchCloseBtn" title="Close search">√ó</button>
        </div>
    </div>
    
    <!-- Screenshot overlay -->
    <div class="screenshot-overlay" id="screenshotOverlay">
        <div class="selection-rectangle" id="selectionRectangle"></div>
    </div>
    
    <!-- Screenshot modal -->
    <div class="screenshot-modal-overlay" id="screenshotModalOverlay">
        <div class="screenshot-modal">
            <div class="screenshot-modal-header">
                <h2 class="screenshot-modal-title">üì∏ Save Screenshot</h2>
                <button class="screenshot-modal-close" id="screenshotModalClose" title="Close">√ó</button>
            </div>
            <div class="screenshot-modal-content">
                <p>Choose how you'd like to save your screenshot:</p>
                
                <!-- Folder selection section (initially hidden) -->
                <div class="folder-selection-section" id="folderSection" style="display: none;">
                    <div class="folder-input-group">
                        <label for="screenshotFolderPath">Save to folder:</label>
                        <div class="folder-input-wrapper">
                            <input type="text" id="screenshotFolderPath" readonly placeholder="Select a folder..." />
                            <button class="browse-btn" id="screenshotBrowseBtn" title="Browse for folder">üìÅ</button>
                        </div>
                    </div>
                </div>
                
                <div class="screenshot-modal-actions">
                    <button class="screenshot-action-btn primary" id="saveToFileBtn">
                        üìÅ Save to File
                    </button>
                    <button class="screenshot-action-btn secondary" id="copyToClipboardBtn">
                        üìã Copy to Clipboard
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="main-content">
        <div class="pdf-container" id="pdfContainer">
            <div class="loading">
                Loading PDF...
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
        <div class="inspector-sidebar" id="inspectorSidebar">
            <div class="sidebar-header">
                <div class="mode-switcher">
                    <button class="mode-btn active" data-mode="objects" title="View by object type">
                        üìä Objects
                    </button>
                    <button class="mode-btn" data-mode="pages" title="View by page">
                        üìÑ Pages  
                    </button>
                </div>
            </div>
            <div class="sidebar-content">
                <div class="tree-container" id="objectTree">
                    <div class="loading-message">Click the inspector button to scan for PDF objects</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Extraction Modal -->
    <div class="extraction-overlay" id="extractionOverlay">
        <div class="extraction-modal">
            <div class="extraction-header">
                <h2 class="extraction-title">üì§ Extract PDF Objects</h2>
                <button class="extraction-close" title="Close">√ó</button>
            </div>
            <div class="extraction-content">
                <div class="extraction-section">
                    <div class="section-header">
                        <h3>üéØ Select Object Types</h3>
                        <button class="select-all-btn">Select All</button>
                    </div>
                    <div class="object-types-grid">
                        <div class="object-type-item">
                            <input type="checkbox" id="type-text" checked>
                            <span class="object-type-icon">üìù</span>
                            <span class="object-type-label">Text Content</span>
                            <span class="object-type-count" id="count-text"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-images">
                            <span class="object-type-icon">üñºÔ∏è</span>
                            <span class="object-type-label">Images</span>
                            <span class="object-type-count" id="count-images"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-tables">
                            <span class="object-type-icon">üìä</span>
                            <span class="object-type-label">Tables</span>
                            <span class="object-type-count" id="count-tables"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-fonts">
                            <span class="object-type-icon">üî§</span>
                            <span class="object-type-label">Fonts</span>
                            <span class="object-type-count" id="count-fonts"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-annotations">
                            <span class="object-type-icon">üìù</span>
                            <span class="object-type-label">Annotations</span>
                            <span class="object-type-count" id="count-annotations"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-formFields">
                            <span class="object-type-icon">üìã</span>
                            <span class="object-type-label">Form Fields</span>
                            <span class="object-type-count" id="count-formFields"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-attachments">
                            <span class="object-type-icon">üìé</span>
                            <span class="object-type-label">Attachments</span>
                            <span class="object-type-count" id="count-attachments"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-bookmarks">
                            <span class="object-type-icon">üîñ</span>
                            <span class="object-type-label">Bookmarks</span>
                            <span class="object-type-count" id="count-bookmarks"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-javascript">
                            <span class="object-type-icon">‚öôÔ∏è</span>
                            <span class="object-type-label">JavaScript</span>
                            <span class="object-type-count" id="count-javascript"></span>
                        </div>
                        <div class="object-type-item">
                            <input type="checkbox" id="type-metadata">
                            <span class="object-type-icon">üìë</span>
                            <span class="object-type-label">Metadata</span>
                            <span class="object-type-count" id="count-metadata"></span>
                        </div>
                    </div>
                </div>
                <div class="extraction-section">
                    <h3>üìÅ Save Location</h3>
                    <div class="folder-picker">
                        <input type="text" class="folder-input" id="folderPath" placeholder="Select folder to save extracted files..." readonly>
                        <button class="folder-browse-btn">Browse</button>
                    </div>
                </div>
                <div class="extraction-progress" id="extractionProgress">
                    <div class="progress-header">
                        <span class="progress-title" id="progressTitle">Extracting objects...</span>
                        <button class="progress-cancel">Cancel</button>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBarFill"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">Preparing extraction...</div>
                    <div class="progress-details" id="progressDetails"></div>
                </div>
            </div>
            <div class="extraction-actions">
                <button class="extraction-btn secondary" id="cancelExtractionBtn">Cancel</button>
                <button class="extraction-btn primary" id="startExtractionBtn" disabled>Extract Selected</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration from template
        // biome-ignore lint: template variables cause linting issues
        const PDF_CONFIG = {
            pdfUri: '{{pdfUri}}',
            isUrl: {{isUrl}},
            fileName: '{{fileName}}'
        };
    </script>
    <script type="module" src="{{scriptUri}}"></script>
</body>
</html>